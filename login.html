<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="js/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="js/kiosk.js"></script>
<script type="text/javascript" src="js/main.js"> </script>
<meta http-equiv="content-type" content="text/html; charset=utf-8">

<script type="text/javascript">
    let tKiosk = initKopaKiosk();

    const login = () => {
        let tNextPage = "oops";
        tKiosk.login($("#kennitala").val(), $("#password").val())
            .then(response => {
                if (response.ok){
                    console.log("response is OK");
                    return response.json().then(
                        data => {
                            Kiosk._storeVar('token', data['access_token']);
                            tNextPage = "home";
                        })
                }
                else if (response.status == 400 || response.status == 401)
                {
                    // Login failure, reload the login page
                    tNextPage = "login";
                }
                else
                {
                    console.log(response);
                    throw -1;
                }
            })
            .catch(error => {
                console.log("response is not OK");
            })
            .finally((info) => {
                itemList.clearSelection();
                window.open(tNextPage + ".html", name="_self");
            });
    }
</script>

<link rel="stylesheet" href="css/login.css" type="text/css">

<title>Log in</title>
</head>

<body>
<div class="header"><div class="top-background"></div></div>
<div class="in-grid left-col8 width-col4"><div class="section-title">Log in</div></div><br/>
<p class="in-grid left-col8 width-col4">Not a member? <a href="signup.html">Sign up</a></p>
<form class="in-grid left-col8 width-col4" id="login">
    <label for="kennitala">Kennitala</label><br/>
    <input type="text" name="kennitala" id="kennitala" /><br/>
    <label for="password">Password</label><br/>
    <input type="password" name="password" id="password" /><br/>
</form>
<div id="forgot" class="in-grid left-col8 width-col4"><a href="reset.html">Forgot password?</a></div>

<div class="rounded-button blue" id="continue" onclick="login()">Continue</div>

<div id="terms" class="in-grid left-col8 width-col4">By clicking "Continue" I accept the <a href="terms.html">Terms and Conditions</a></div>

<div class="footer"><div class="bottom-background"></div></div>

</body>

</html> 